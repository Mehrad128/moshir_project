- name: Fix desugaring configuration
  working-directory: ./moshir_ui  # ÛŒØ§ Ù‡Ø± Ù…Ø³ÛŒØ±ÛŒ Ú©Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ù‡Ø³Øª
  run: |
    echo "ðŸ”§ Fixing desugaring configuration..."
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú¯ÛŒØ±ÛŒ
    cp android/app/build.gradle android/app/build.gradle.backup 2>/dev/null || true
    cp android/app/build.gradle.kts android/app/build.gradle.kts.backup 2>/dev/null || true
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ (Groovy ÛŒØ§ KTS)
    if [ -f "android/app/build.gradle" ]; then
      # Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„ build.gradle (Groovy)
      cat >> android/app/build.gradle << 'EOF'

android {
    defaultConfig {
        // Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² desugaring
        multiDexEnabled true
    }

    compileOptions {
        // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† desugaring
        coreLibraryDesugaringEnabled true
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

dependencies {
    // Ø§ÙØ²ÙˆØ¯Ù† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ desugaring
    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:2.0.4'
}
EOF
      echo "âœ… Updated build.gradle (Groovy)"
      
    elif [ -f "android/app/build.gradle.kts" ]; then
      # Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„ build.gradle.kts (Kotlin)
      cat >> android/app/build.gradle.kts << 'EOF'

android {
    defaultConfig {
        // Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² desugaring
        multiDexEnabled = true
    }

    compileOptions {
        // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† desugaring
        isCoreLibraryDesugaringEnabled = true
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
}

dependencies {
    // Ø§ÙØ²ÙˆØ¯Ù† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ desugaring
    "coreLibraryDesugaring"("com.android.tools:desugar_jdk_libs:2.0.4")
}
EOF
      echo "âœ… Updated build.gradle.kts (Kotlin)"
    fi
    
    echo "âœ… Desugaring configuration added"
    
- name: Clean and rebuild
  working-directory: ./moshir_ui
  run: |
    flutter clean
    flutter pub get
    flutter build apk --debug